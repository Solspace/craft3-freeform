{% extends "freeform-demo/_layout" %}

{% set pageTitle = "Extras" %}
{% set page = "extras" %}

{% block content %}

<div class="container">

    <h2>Populate Field Options at Template Level</h2>
    <p>The example populate field options such as Selects, Checkbox Groups or Radio Groups dynamically at template level.</p>
    <hr />

    {# Replace "populateField" with your form handle #}
    {% set form = craft.freeform.form("populateField") %}

    {% if form %}

        <h3>{{ form.name }}</h3>
        <br />

        {{ form.renderTag }}

            {% if form.pages|length > 1 %}
                <ul class="freeform-pages">
                    {% for page in form.pages %}
                        <li>
                            {% if form.currentPage.index == page.index %}
                                <b>{{ page.label }}</b>
                            {% else %}
                                {{ page.label }}
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %} 

            {% if form.hasErrors %}
                <div class="freeform-form-has-errors">
                    {{ "Error! Please review the form and try submitting again."|t('freeform') }}

                    {% if form.errors|length %}
                        <ul>
                            {% for error in form.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% endif %}

            {% for row in form %}
                <div class="freeform-row {{ form.customAttributes.rowClass }}">
                    {% for field in row %}
                    {% set columnClass = "freeform-column " ~ form.customAttributes.columnClass %}
                    {% if field.type == "submit" %}
                        {% set columnClass = columnClass ~ "freeform-column-content-align-" ~ field.position %}
                    {% endif %}

                    <div class="{{ columnClass }}"{{ field.rulesHtmlData }}>
                    
                        {# Replace "equipment" with your form handle #}
                        {% if field.handle == "equipment" %}
                            {{ field.renderLabel() }}
                            <select name="{{ field.handle }}" id="{{ field.idAttribute }}">
                                <option>Please select...</option>
                                    {% set entry = craft.entries.one %}

                                    {# Replace "coffeeMachine" with your field name #}
                                    {% for option in entry.coffeeMachine %}
                                <option value="{{ option.value }}">{{ option.label }}</option>
                        {% endfor %}

                            </select>

                            {{ field.renderErrors() }}

                        {% else %}

                            {{ field.render ({
                                class: field.type not in ["submit", "signature"] ? "freefom-input" : "",
                                labelClass: "freeform-label" ~ (field.inputOnly ? "freeform-input-only-label" : "") ~ (field.required ? " freeform-fequired" : ""),
                                errorClass: "freeform-errors",
                                instructionsClass: "freeform-instructions",
                            }) }}

                        {% endif %}

                    </div>

                    {% endfor %}

                </div>
            {% endfor %}
        {{ form.renderClosingTag }} 

    {% else %}
    {# Show instructions to developer if they wish to see this page work correctly #}
    
        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">You can't see this page correctly until...</h4>
            <p class="mb-0">
                In order to view this page live, you'll need to make some adjustments to this template or on your test from:
                <ol class="mb-0">
                    <li>Rename your test form handle to <code>populateField</code> ( or adjust the handle name this template is looking for).</li>
                    <li>
                        Make sure your t est form includes the following fields (at minimum):
                        <ul>
                            <li>First Name text field with handle of <code>firstName</code>.</li> 
                            <li>Last Name text field with handle of <code>LastName</code>.</li>
                            <li>Address text field with handle of <code>address</code>.</li> 
                            <li>Message text field with handle of  <code>message</code>.</li>
                            <li>Equipment text field with handle of <code>equipment</code>.</li>
                        </ul>
                    </li>
                    <li>The person viewing this form is logged into their Craft account to see this working.</li>
                    <li>The person viewing this form have a first and last name set in their User account.</li>
                </ol>
            </p>
        </div>

    {% endif %}

</div>

{% endblock %}