{% extends "freeform-demo/_layout" %}

{% set pageTitle = "Extras" %}
{% set page = "extras" %}

{# Replace 'twigCache' with your form handle. #}
{% set form = craft.freeform.form("twigCache") %}

{% block content %}

<div class= "container">
    <h2>Twig Template Caching</h1>
    <p>The example using simple "Craft Caching", you'll need to make sure that you are refreshing the "CSRF token"</p>
    <hr />

    {% if form %}

        <h3>{{ form.name }}</h3>
        <br />
        
        <p class="userName">
            {% cache %}
                {{ random(50, 100) }}
                {{ form.render }}
            {% endcache %}
        </p>

        <script>
            var form = document.querySelector('.mainContent form');

            var formHashInput = form.querySelector('input[name=formHash]');
            formHashInput.setAttribute('value', '{{ form.hash }}');

            var csrfInput = form.querySelector('input[name={{ craft.app.config.general.csrfTokenName|e('js') }}]');
            csrfInput.value = '{{ craft.app.request.csrfToken|e('js') }}';
        </script>
        
    {% else %}
    {# Show instructions to developer if they wish to see this page work correctly #}

        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">You can't see this page correctly until...</h4>
            <p class="mb-0">
                In order to view this page live, you'll need to make some adjustments to this template or on your test from:
                <ol class="mb-0">
                    <li>Rename your test form handle to <code>twigCache</code> ( or adjust the handle name this template is looking for).</li>
                    <li>
                        Make sure your t est form includes the following fields (at minimum):
                        <ul>
                            <li>First Name text field with handle of <code>firstName</code>.</li> 
                            <li>Last Name text field with handle of <code>LastName</code>.</li>
                            <li>USA state select field with handle of <code>state</code>, and option value that use 2-letter code (e.g. <code>CA</code>).</li> 
                            <li>Email address field with handle of  <code>email</code>.</li>
                            <li>Website text field with handle of <code>website</code>.</li>
                        </ul>
                    </li>
                    <li>The person viewing this form is logged into their Craft account to see this working.</li>
                    <li>The person viewing this form have a first and last name set in their User account.</li>
                </ol>
            </p>
        </div>
    
    {% endif %}

</div>

{% endblock %}